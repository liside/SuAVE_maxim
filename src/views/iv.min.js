var IV={_isOn:!1,count:0}
IV.on=function(){if(!IV._isOn){IV._isOn=!0
var e=function(e){var t=$(this),i=PivotCollection.getCategoryByName(PV.uncleanName(t.attr("facet")))
if(i.isDateTime())return!1
if("iv"==t.attr("mode")){t.find(".pv-iv-code").remove(),i.doFilter=!0,t.children().css("color","black"),t.removeAttr("mode"),t.next().find(".pv-facet-value").show(),t.next().find(".pv-facet-iv").remove(),t.next().find(".pv-facet-value-label").css("color","black")
var n=t.next().find(".pv-facet-numericslider")
return n.modSlider("values",[n.modSlider("option","min"),n.modSlider("option","max")]),n.parent().find(".pv-facet-numericslider-range-val").text(n.modSlider("option","min")+" - "+n.modSlider("option","max")),$.publish("/PivotViewer/Views/IVFiltered"),!1}if(void 0!=t.attr("mode")||0!=t.next().find(".pv-facet-value:checked").length)return!1
t.find("a").append(" <span class='pv-iv-code'>("+String.fromCharCode(65+IV.count++)+")</span>"),t.attr("mode","iv"),t.children().css("color","blue")
var i=PivotCollection.getCategoryByName(PV.uncleanName(t.attr("facet")))
i.uiInit||PV.initUICategory(i),i.doFilter=!1
var a=t.next().find(".pv-facet-value")
a.next()
return a.next().css("color","blue"),a.each(function(){$(this).after("<input type='checkbox' class='pv-facet-iv' itemvalue='"+$(this).attr("itemvalue")+"'>"),$(this).next().click(function(e){clickValue(this)})}),a.hide(),$.publish("/PivotViewer/Views/IVFiltered"),!1}
IV.clickValue=PV.clickValue,PV.clickValue=function(e){"iv"!=$(e).parent().parent().parent().prev().attr("mode")?IV.clickValue(e):$.publish("/PivotViewer/Views/IVFiltered")},IV._stopSlider=PV._stopSlider,PV._stopSlider=function(e,t,i,n){"iv"!=e.parent().parent().prev().attr("mode")?IV._stopSlider(e,t,i,n):$.publish("/PivotViewer/Views/IVFiltered")},$(".pv-facet").on("contextmenu.iv",e)}},IV.off=function(){if(IV._isOn){IV._isOn=!1
var e=$(".pv-facet[mode='iv']")
e.each(function(){PivotCollection.getCategoryByName(PV.uncleanName($(this).attr("facet"))).doFilter=!0}),e.find(".pv-iv-code").remove(),e.children().css("color","black"),e.next().find(".pv-facet-value-label").css("color","black"),$(".pv-facet").off("contextmenu.iv"),e.next().find(".pv-facet-value").show(),e.next().find(".pv-facet-iv").remove(),e.next().find(".pv-facet-numericslider").each(function(){var e=$(this)
e.parent().find(".pv-facet-numericslider-range-val").text(e.modSlider("option","min")+" - "+e.modSlider("option","max")),e.modSlider("values",[e.modSlider("option","min"),e.modSlider("option","max")])}),e.removeAttr("mode"),PV.clickValue=IV.clickValue,PV._sliderStop=IV._sliderStop}},IV.isOn=function(){return IV._isOn},IV.isIV=function(e){"object"==typeof e&&(e=e.name)
var t=$(".pv-facet[facet='"+PV.cleanName(e.toLowerCase())+"']")
return"iv"==t.attr("mode")},IV.getIV=function(){for(var e=$(".pv-facet[mode='iv']"),t=[],i=[],n=0;n<e.length;n++){var a=PivotCollection.getCategoryByName(PV.uncleanName(e.eq(n).attr("facet")))
if(a.ivCode=e.eq(n).find(".pv-iv-code").html().charAt(1),t.push(a),i.push([]),a.isString()){var o=e.next().find(".pv-facet-iv:checked")
0==o.length&&(o=e.next().find(".pv-facet-iv"))
for(var r=0;r<o.length;r++){var c=PV.uncleanName(o.eq(r).attr("itemvalue"))
i[n][c]=!0,i[n].push(c)}}else{var l=$("#pv-facet-numericslider-"+PV.cleanName(a.name)).modSlider("option","values")
i[n].push(l[0]),i[n].push(l[1])}}return{categories:t,values:i}}
