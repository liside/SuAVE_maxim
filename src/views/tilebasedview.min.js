//
//  HTML5 PivotViewer
//
//  Collection loader interface - used so that different types of data sources can be used
//
//  Original Code:
//    Copyright (C) 2011 LobsterPot Solutions - http://www.lobsterpot.com.au/
//    enquiries@lobsterpot.com.au
//
//  Enhancements:
//    Copyright (C) 2012-2014 OpenLink Software - http://www.openlinksw.com/
//
//  This software is licensed under the terms of the
//  GNU General Public License v2 (see COPYING)
//
PivotViewer.Views.TileBasedView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super()
var t=this
$.subscribe("/PivotViewer/Views/Canvas/Drag",function(e){if(t.isActive){var i=e.x,s=e.y
i>0&&t.currentOffsetX>t.offsetX?i=0:t.currentOffsetX<t.offsetX&&t.currentWidth==t.width?i=0:i<0&&t.currentOffsetX<-t.currentWidth+t.width?i=0:t.currentOffsetX+=i,s>0&&t.currentOffsetY+t.canvasHeightUIAdjusted>t.currentHeight+t.offsetY?s=0:t.currentOffsetY<t.offsetY&&t.currentHeight==t.height?s=0:s<0&&t.currentOffsetY-t.offsetY<-t.currentHeight+t.height?s=0:t.currentOffsetY+=s,0==i&&0==s||t.offsetTiles(i,s)}})},super_handleClick:function(t){for(var e=0;e<this.filterList.length;e++){var i=this.filterList[e].contains(t.x,t.y)
if(i>=0)return this.filterList[e]}},handleClick:function(t){return this.super_handleClick(t)},super_handleHover:function(t){if(null==this.selected)for(var e=0;e<this.filterList.length;e++){var i=this.filterList[e].contains(t.x,t.y)
i>=0?this.filterList[e].setSelected(!0):this.filterList[e].setSelected(!1)}},handleHover:function(t){this.super_handleHover(t)},activate:function(){this._super(),$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$("#MAIN_BODY").css("overflow","auto"),$(".pv-toolbarpanel-sort").fadeIn(),$(".pv-canvas").fadeIn()},deactivate:function(){this._super(),$(".pv-toolbarpanel-zoomslider").fadeOut(),$(".pv-toolbarpanel-sort").fadeOut(),$(".pv-canvas").fadeOut()},offsetTiles:function(t,e){for(var i=0;i<this.filterList.length;i++)this.filterList[i]._locations[0].destinationx+=t,this.filterList[i]._locations[0].destinationy+=e},calculateDimensions:function(t,e,i,s){console.debug("tilebasedview tileMaxRatio:",i)
var r=.9,n=i*(s-r*r),o=(e+t*i)*r,a=-1*(e*t),f=(-1*o+Math.sqrt(o*o-4*n*a))/(2*n),l=Math.floor(f*i),h=Math.floor(e/l),u=t>f?Math.floor(t/f):1,c=t-u*f,d=e-h*l
return l<3&&(l=3),{Rows:h,Columns:u,TileMaxWidth:f,TileHeight:l,PaddingX:c,PaddingY:d}},getTileDimensions:function(t,e,i,s,r){var n=.9,o=i*(s-n*n),a=(e+t*i)*n,f=-1*(e*t),l=(-1*a+Math.sqrt(a*a-4*o*f))/(2*o),h=Math.floor(l*i),u=t-r.Columns*l,c=e-r.Rows*h
return{Rows:r.Rows,Columns:r.Columns,TileMaxWidth:l,TileHeight:h,PaddingX:u,PaddingY:c}}})
